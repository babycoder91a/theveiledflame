<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Umbralis Encounter</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
            font-family: 'Cinzel', serif;
            color: white;
        }
        .scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: url('https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c83eed7c-83c0-428e-9948-0422c757b242.png') no-repeat center center;
            background-size: cover;
        }
        .hotspot {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            animation: pulse 1.5s infinite;
            z-index: 10;
        }
        .hotspot:hover {
            box-shadow: 0 0 20px 5px rgba(0,255,0,0.8);
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px 2px rgba(0,255,0,0.4); }
            50% { box-shadow: 0 0 20px 5px rgba(0,255,0,0.8); }
        }
        #dialogueBox {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border: 2px solid #0f0;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 100;
        }
        .choice {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 50, 0, 0.8);
            border: 1px solid #0f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .choice:hover {
            background: rgba(0, 100, 0, 0.9);
            transform: scale(1.02);
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #0f0;
        }
    </style>
</head>
<body>

<div class="scene">
    <div id="necklace" class="hotspot" style="top:60%; left:48%; width:60px; height:60px;"></div>
    <div id="earring" class="hotspot" style="top:33%; left:58%; width:40px; height:40px;"></div>
    <div id="mist" class="hotspot" style="top:40%; left:10%; width:120px; height:120px;"></div>
</div>

<div id="dialogueBox">
    <div id="dialogueText"></div>
    <div id="choices"></div>
</div>

<script>
    // Track found clues
    let cluesFound = { 
        necklace: false, 
        earring: false, 
        mist: false 
    };

    // Initialize hotspot click handlers
    function initHotspots() {
        document.getElementById("necklace").onclick = () => hotspotClick("necklace", "Glyph revealed. The necklace pulses with mystic energy.");
        document.getElementById("earring").onclick = () => hotspotClick("earring", "A whisper passes through you. The earring hums faintly.");
        document.getElementById("mist").onclick = () => hotspotClick("mist", "Vision fades into shadow. The mist coalesces into strange shapes.");
    }

    // Check if all clues have been found
    function checkAllClues() {
        if (cluesFound.necklace && cluesFound.earring && cluesFound.mist) {
            showDialogue(
                "The Umbralis turns to you, her eyes like emerald fire. 'You have seen what was hidden... now choose your path.'",
                [
                    { 
                        text: "Bow in reverence", 
                        action: () => {
                            endScene("She bows in return and gifts you the Shard of Seeing.", "#00FF00");
                        } 
                    },
                    { 
                        text: "Demand answers", 
                        action: () => {
                            endScene("Her gaze hardens. 'Then you shall walk alone.' The priestess vanishes into the mist.", "#FF0000");
                        } 
                    },
                    { 
                        text: "Speak her true name", 
                        action: () => {
                            endScene("Shock registers on her face before she kneels, pledging herself to your cause.", "#FFFFFF");
                        } 
                    }
                ]
            );
        }
    }

    // Handle hotspot clicks
    function hotspotClick(id, message) {
        if (!cluesFound[id]) {
            cluesFound[id] = true;
            showTempMessage(message);
            let el = document.getElementById(id);
            el.style.animation = "none";
            el.style.boxShadow = "0 0 15px 3px rgba(0,255,0,0.8)";
            checkAllClues();
        } else {
            showTempMessage("You've already examined this.");
        }
    }

    // Show dialogue with choices
    function showDialogue(text, choices) {
        document.getElementById("dialogueText").innerText = text;
        let choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML = '';
        choices.forEach(c => {
            let btn = document.createElement("div");
            btn.className = "choice";
            btn.innerText = c.text;
            btn.onclick = c.action;
            choicesDiv.appendChild(btn);
        });
        document.getElementById("dialogueBox").style.opacity = '1';
    }

    // Show temporary message
    function showTempMessage(message) {
        document.getElementById("dialogueText").innerText = message;
        document.getElementById("choices").innerHTML = '';
        document.getElementById("dialogueBox").style.opacity = '1';
        setTimeout(() => {
            if (!(cluesFound.necklace && cluesFound.earring && cluesFound.mist)) {
                document.getElementById("dialogueBox").style.opacity = '0';
            }
        }, 3000); // 3 seconds for clue messages
    }

    // End the scene with an outcome
    function endScene(outcome, color) {
        document.getElementById("dialogueText").innerText = outcome;
        document.getElementById("choices").innerHTML = '';
        document.getElementById("dialogueBox").style.borderColor = color;
    }

    // Initialize when page loads
    window.onload = function() {
        initHotspots();
        
        // Error handling for the background image
        document.querySelector('.scene').addEventListener('error', function(e) {
            console.error('Background image failed to load:', e);
            this.style.backgroundColor = '#000';
            let errorMsg = document.createElement('div');
            errorMsg.className = 'loading';
            errorMsg.textContent = 'Failed to load Umbralis Priestess image';
            this.appendChild(errorMsg);
        }, true);
    };
</script>

</body>
</html>

