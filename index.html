<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Veiled Flame: The Quest for Truth</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #0b0c10;
    color: #d0dfff;
    text-align: center;
    min-height: 100vh;
    margin: 0;
    padding: 1rem;
    user-select: none;
  }
  .container {
    max-width: 600px;
    margin: 2rem auto;
    background: #12161f;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 0 40px #0066ff66;
  }
  h1 {
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 0 0 8px #3399ffbb;
  }
  .flame-container {
    position: relative;
    width: 60px;
    height: 140px;
    margin: 0 auto 2rem;
    filter: drop-shadow(0 0 10px #00b3ffcc);
  }
  .flame {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 30px;
    height: 90px;
    background: radial-gradient(circle at 50% 80%, rgba(0, 150, 255, 0.9), transparent 70%);
    border-radius: 40% 40% 50% 50% / 70% 70% 30% 30%;
    animation: flicker 1.2s infinite alternate ease-in-out;
    box-shadow: 0 0 15px 8px rgba(0, 170, 255, 0.8);
    transform: translateX(-50%);
    filter: drop-shadow(0 0 15px #00aaff);
    transition: background 0.5s ease, box-shadow 0.5s ease, filter 0.5s ease;
  }
  .flicker-delay {
    animation-delay: 0.4s;
    width: 25px;
    height: 70px;
    opacity: 0.7;
    filter: drop-shadow(0 0 10px #00aaffcc);
    bottom: 10px;
    left: 48%;
  }
  .flicker-delay-2 {
    animation-delay: 0.7s;
    width: 20px;
    height: 55px;
    opacity: 0.5;
    filter: drop-shadow(0 0 8px #0099ffbb);
    bottom: 15px;
    left: 52%;
  }
  @keyframes flicker {
    0% {
      height: 85px;
      opacity: 1;
      filter: drop-shadow(0 0 15px var(--flame-color));
    }
    50% {
      height: 100px;
      opacity: 0.7;
      filter: drop-shadow(0 0 30px var(--flame-color));
    }
    100% {
      height: 90px;
      opacity: 1;
      filter: drop-shadow(0 0 20px var(--flame-color));
    }
  }
  #game-area {
    margin-top: 1rem;
  }
  #location, #event-card {
    margin: 0.8rem 0;
    font-size: 1.1rem;
    font-weight: 600;
  }
  #choice-area {
    margin: 1rem 0;
  }
  button {
    background-color: #005bb5;
    border: none;
    padding: 10px 18px;
    margin: 0 0.5rem;
    color: #cce7ff;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 8px #3399ff88;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #003d80;
  }
  #message {
    margin-top: 1rem;
    min-height: 60px;
    font-weight: 600;
    font-style: italic;
    color: #aad4ff;
  }
  #sanity-meter {
    margin-top: 2rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: #66ccff;
    text-shadow: 0 0 10px #00aaffaa;
  }
  input#player-choice {
    padding: 8px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
    margin-right: 0.5rem;
    width: 200px;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Veiled Flame: The Quest for Truth</h1>
    <div class="flame-container" style="--flame-color: #00aaff">
      <div class="flame"></div>
      <div class="flame flicker-delay"></div>
      <div class="flame flicker-delay-2"></div>
    </div>
    <div id="game-area">
      <div id="location">Location: <span id="current-location">The Cedar Compound</span></div>
      <div id="event-card">Event: <span id="event-text">Draw an event card to begin...</span></div>
      <div id="choice-area">
        <button id="draw-card">Draw Event Card</button>
        <button id="next-location">Next Location</button>
      </div>
      <div id="message"></div>
    </div>
    <div id="sanity-meter">Sanity: 5</div>
  </div>

  <script>
    const locations = [
      "The Cedar Compound",
      "The Monastery Basement",
      "The Umbralis Sanctum",
      "The Forgotten Crypt"
    ];

    // Sanity max is 10, min 0
    let sanity = 5;
    let currentLocationIndex = 0;

    const currentLocationEl = document.getElementById("current-location");
    const eventTextEl = document.getElementById("event-text");
    const messageEl = document.getElementById("message");
    const sanityMeterEl = document.getElementById("sanity-meter");
    const drawCardBtn = document.getElementById("draw-card");
    const nextLocationBtn = document.getElementById("next-location");
    const flameContainer = document.querySelector(".flame-container");

    // Helper: interpolate between two colors (hex) by factor t 0-1
    function lerpColor(a, b, t) {
      const c1 = parseInt(a.slice(1),16);
      const c2 = parseInt(b.slice(1),16);

      const r1 = (c1 >> 16) & 0xff;
      const g1 = (c1 >> 8) & 0xff;
      const b1 = c1 & 0xff;

      const r2 = (c2 >> 16) & 0xff;
      const g2 = (c2 >> 8) & 0xff;
      const b2 = c2 & 0xff;

      const r = Math.round(r1 + (r2 - r1) * t);
      const g = Math.round(g1 + (g2 - g1) * t);
      const b = Math.round(b1 + (b2 - b1) * t);

      return `rgb(${r},${g},${b})`;
    }

    function updateFlameColor() {
      // sanity: 10 = bright blue #00aaff, 0 = purple #8800cc
      const blue = "#00aaff";
      const purple = "#8800cc";

      // Map sanity 0-10 to 1-0 (purple to blue)
      const t = 1 - (sanity / 10);
      const color = lerpColor(blue, purple, t);

      // Set CSS var for flame color
      flameContainer.style.setProperty("--flame-color", color);

      // Also update sanity meter color
      sanityMeterEl.style.color = color;
      sanityMeterEl.style.textShadow = `0 0 10px ${color}aa`;
    }

    function updateSanity(change) {
      sanity += change;
      if (sanity > 10) sanity = 10;
      if (sanity < 0) sanity = 0;

      sanityMeterEl.textContent = `Sanity: ${sanity}`;
      updateFlameColor();

      if (sanity === 0) {
        messageEl.textContent = "Your mind fractures into the void. The Veil consumes you.";
        drawCardBtn.disabled = true;
        nextLocationBtn.disabled = true;
        removeChoiceInput();
      }
    }

    function removeChoiceInput() {
      const input = document.getElementById("player-choice");
      const submit = document.getElementById("submit-choice");
      if (input) input.remove();
      if (submit) submit.remove();
    }

    // Updated event cards with resist causing sanity loss
    const eventCards = [
      {
        text: "The black ichor stains your hands. Do you embrace or resist its power?",
        choices: {
          embrace: {
            response: "Power courses through your veins, but madness claws at your mind.",
            sanityChange: +1
          },
          resist: {
            response: "The Veil fights back, fraying your mind’s edges.",
            sanityChange: -1
          }
        }
      },
      {
        text: "Whispers from the Necrenomecon call. Do you read aloud or silence the voices?",
        choices: {
          read: {
            response: "The forbidden knowledge floods your mind, clarity and chaos entwined.",
            sanityChange: -1
          },
          silence: {
            response: "You block out the arcane murmurs, preserving your fragile sanity.",
            sanityChange: +1
          }
        }
      },
      {
        text: "A shadowy cultist offers forbidden knowledge. Accept or refuse?",
        choices: {
          accept: {
            response: "The secrets granted sharpen your perception but stain your soul.",
            sanityChange: -1
          },
          refuse: {
            response: "You deny the cultist’s gift, choosing caution over temptation.",
            sanityChange: +1
          }
        }
      },
      {
        text: "The Splinter fractures anew. Do you attempt to bind it or flee?",
        choices: {
          bind: {
            response: "Your ritual calms the fracturing shard, but it drains your spirit.",
            sanityChange: -1
          },
          flee: {
            response: "You escape the fracturing’s pull, but the cost lingers in your mind.",
            sanityChange: 0
          }
        }
      },
      {
        text: "The Vessel’s bond pulses. Do you strengthen it with a ritual or sever it to save yourself?",
        choices: {
          strengthen: {
            response: "The bond deepens, granting clarity but binding your fate irrevocably.",
            sanityChange: 0
          },
          sever: {
            response: "You break the bond, a desperate act that fractures your soul.",
            sanityChange: -2
          }
        }
      }
    ];

    function startEvent() {
      // Pick a random event card
      const eventIndex = Math.floor(Math.random() * eventCards.length);
      const event = eventCards[eventIndex];

      eventTextEl.textContent = event.text;
      messageEl.textContent = "";

      removeChoiceInput();

      // Create input box and submit button
      const input = document.createElement("input");
      input.id = "player-choice";
      input.placeholder = "Type your choice here...";
      input.autocomplete = "off";
      input.autofocus = true;

      const submit = document.createElement("button");
      submit.id = "submit-choice";
      submit.textContent = "Submit";

      messageEl.appendChild(input);
      messageEl.appendChild(submit);

      submit.addEventListener("click", () => {
        const choice = input.value.trim().toLowerCase();

        if (choice in event.choices) {
          const outcome = event.choices[choice];
          messageEl.textContent = outcome.response;
          updateSanity(outcome.sanityChange);
          drawCardBtn.disabled = false;
          removeChoiceInput();
        } else {
          messageEl.textContent = "The Veil does not understand your hesitation. Choose carefully.";
        }
      });
    }

    drawCardBtn.addEventListener("click", () => {
      drawCardBtn.disabled = true;
      startEvent();
    });

    nextLocationBtn.addEventListener("click", () => {
      currentLocationIndex = (currentLocationIndex + 1) % locations.length;
      currentLocationEl.textContent = locations[currentLocationIndex];
      eventTextEl.textContent = "Draw an event card to begin...";
      messageEl.textContent = "";
      drawCardBtn.disabled = false;
      removeChoiceInput();
    });

    // Init UI
    sanityMeterEl.textContent = `Sanity: ${sanity}`;
    currentLocationEl.textContent = locations[currentLocationIndex];
    updateFlameColor();
  </script>
</body>
</html>
